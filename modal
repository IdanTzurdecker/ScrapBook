import React, { useEffect, useState } from 'react';
import NiceModal, { useModal } from '@ebay/nice-modal-react';
import { Box, Button, Modal, Typography, Select, MenuItem } from '@mui/material';
import { ldClient } from 'your-launchdarkly-setup'; // Import your Launch Darkly client setup

export default NiceModal.create(() => {
  const modal = useModal();
  const [oktaToken, setOktaToken] = useState('');
  const [launchDarklyFlags, setLaunchDarklyFlags] = useState([]);
  const [selectedFlag, setSelectedFlag] = useState('');

  useEffect(() => {
    // Fetch Okta Token from Local Storage
    const token = localStorage.getItem('okta-token-storage');
    setOktaToken(token || 'No token found');

    // Fetch Launch Darkly Flags
    ldClient.allFlags().then((flags) => {
      const enabledFlags = Object.keys(flags).filter(flagKey => flags[flagKey]);
      setLaunchDarklyFlags(enabledFlags);
    });
  }, []);

  const handleFlagChange = (event) => {
    setSelectedFlag(event.target.value);
  };

  return (
    <Modal open={modal.visible} onClose={() => modal.hide()}>
      <Box sx={{ padding: 4, backgroundColor: 'white', maxWidth: 600, margin: 'auto', top: '50%', position: 'absolute', transform: 'translateY(-50%)' }}>
        <Typography variant="h6">User Information</Typography>
        <Typography variant="body1">Okta Token: {oktaToken}</Typography>

        <Typography variant="h6" sx={{ marginTop: 2 }}>Enabled Launch Darkly Flags</Typography>
        <Select value={selectedFlag} onChange={handleFlagChange} fullWidth>
          {launchDarklyFlags.map(flag => (
            <MenuItem key={flag} value={flag}>{flag}</MenuItem>
          ))}
        </Select>

        <Button onClick={() => modal.hide()} variant="contained" color="primary" sx={{ marginTop: 2 }}>Close</Button>
      </Box>
    </Modal>
  );
});
